# 月影の郷 予約システム スプレッドシート設定ガイド

## 📋 ステップ1: 予約管理用スプレッドシートの作成

### 1.1 スプレッドシートの作成
1. [Google Sheets](https://sheets.google.com) にアクセス
2. 「新しいスプレッドシート」をクリック
3. スプレッドシート名を「月影の郷_予約管理表」に変更

### 1.2 シートの作成
以下のシートを作成してください：

#### 1.2.1 「予約」シート
以下のヘッダーをA1からK1に設定：

| A1 | B1 | C1 | D1 | E1 | F1 | G1 | H1 | I1 | J1 | K1 |
|---|---|---|---|---|---|---|---|---|---|---|
| 予約ID | チェックイン日 | チェックアウト日 | 部屋ID | 部屋名 | 宿泊人数 | 大人 | 子供 | お客様名 | 電話番号 | メールアドレス |

#### 1.2.2 「部屋管理」シート
以下のヘッダーをA1からE1に設定：

| A1 | B1 | C1 | D1 | E1 |
|---|---|---|---|---|
| 部屋ID | 部屋名 | 定員 | 料金（1泊） | カレンダーID |

### 1.3 部屋データの入力
「部屋管理」シートに以下のデータを入力：

| 部屋ID | 部屋名 | 定員 | 料金（1泊） | カレンダーID |
|---|---|---|---|---|
| washitsu-a | 和室A | 2 | 28000 | c_d7a00081dad30a339865552ea1ed1af4340ba448757a049eae595c8d5da68e79@group.calendar.google.com |
| washitsu-b | 和室B | 4 | 35000 | c_7b9e2504e93b464880f6ec6d28f4ff3cb92c8b1bfda747362eaf74452f6df400@group.calendar.google.com |
| washitsu-c | 和室C | 3 | 42000 | c_36fee39dbc5234aebf6fd6f103003b671d1fd73292230a67f821db9eeaff5c64@group.calendar.google.com |
| onsen-room | 露天風呂付き客室 | 3 | 45000 | c_29a693c338b3dd1ecfe0130fb3a3749b00ced420df6d601ab0b9b0e419363155@group.calendar.google.com |
| special-room | 特別室 | 4 | 65000 | c_6a49d730dee64c602807be7781dff924de54ebbcaf5eef1f81db7fe13b40672b@group.calendar.google.com |

### 1.4 列幅の調整
**「予約」シート**
- A列（予約ID）: 120px
- B列（チェックイン日）: 120px
- C列（チェックアウト日）: 120px
- D列（部屋ID）: 100px
- E列（部屋名）: 150px
- F列（宿泊人数）: 80px
- G列（大人）: 80px
- H列（子供）: 80px
- I列（お客様名）: 150px
- J列（電話番号）: 120px
- K列（メールアドレス）: 200px

**「部屋管理」シート**
- A列（部屋ID）: 120px
- B列（部屋名）: 150px
- C列（定員）: 80px
- D列（料金）: 100px
- E列（カレンダーID）: 300px

## 🔧 ステップ2: Google Calendarの設定

### 2.1 各部屋用のカレンダーを作成
1. [Google Calendar](https://calendar.google.com) にアクセス
2. 左側の「+」ボタンをクリック
3. 「新しいカレンダーを作成」を選択
4. 以下のカレンダーを作成：
   - 「月影の郷_和室A」
   - 「月影の郷_和室B」
   - 「月影の郷_和室C」
   - 「月影の郷_露天風呂付き客室」
   - 「月影の郷_特別室」

### 2.2 カレンダーIDの取得
1. 各カレンダーの設定を開く
2. 「カレンダーの統合」タブをクリック
3. 「カレンダーID」をコピー
4. 上記の表の「カレンダーID」列に貼り付け

### 2.3 カレンダーの共有設定
1. 各カレンダーの設定で「特定のユーザーと共有」
2. サービスアカウントのメールアドレスを追加
3. 権限：「予定の変更」を選択

## ⚙️ ステップ3: Google Apps Scriptの設定

### 3.1 Apps Scriptを開く
1. スプレッドシートの「拡張機能」メニューをクリック
2. 「Apps Script」を選択

### 3.2 コードの貼り付け
デフォルトの `Code.gs` ファイルの内容を削除し、`reservation-system-working.js` の内容を貼り付け

### 3.3 設定の更新
コード内の以下の設定を更新：
```javascript
const CONFIG = {
  // Google Calendar ID（実際のIDに置き換えてください）
  calendarId: 'c_6a49d730dee64c602807be7781dff924de54ebbcaf5eef1f81db7fe13b40672b@group.calendar.google.com',
  
  // Google Sheets ID（実際のIDに置き換えてください）
  spreadsheetId: 'YOUR_SPREADSHEET_ID',
  
  // 部屋設定（カレンダーIDを実際のものに更新）
  rooms: {
    'washitsu-a': {
      name: '和室A',
      capacity: 2,
      price: 28000,
      calendarId: 'c_d7a00081dad30a339865552ea1ed1af4340ba448757a049eae595c8d5da68e79@group.calendar.google.com'
    },
    'washitsu-b': {
      name: '和室B',
      capacity: 4,
      price: 35000,
      calendarId: 'c_7b9e2504e93b464880f6ec6d28f4ff3cb92c8b1bfda747362eaf74452f6df400@group.calendar.google.com'
    },
    'washitsu-c': {
      name: '和室C',
      capacity: 3,
      price: 42000,
      calendarId: 'c_36fee39dbc5234aebf6fd6f103003b671d1fd73292230a67f821db9eeaff5c64@group.calendar.google.com'
    },
    'onsen-room': {
      name: '露天風呂付き客室',
      capacity: 3,
      price: 45000,
      calendarId: 'c_29a693c338b3dd1ecfe0130fb3a3749b00ced420df6d601ab0b9b0e419363155@group.calendar.google.com'
    },
    'special-room': {
      name: '特別室',
      capacity: 4,
      price: 65000,
      calendarId: 'c_6a49d730dee64c602807be7781dff924de54ebbcaf5eef1f81db7fe13b40672b@group.calendar.google.com'
    }
  }
};
```

### 3.4 デプロイの設定
1. 「デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択
3. 以下の設定を行う：
   - **種類の選択**: 「ウェブアプリ」
   - **説明**: 「月影の郷 予約システムAPI」
   - **次のユーザーとして実行**: 「自分」
   - **アクセスできるユーザー**: 「全員」
4. 「デプロイ」をクリック
5. 承認を求められたら「許可」をクリック
6. 表示されるURLをコピー

## 🧪 ステップ4: 動作確認

### 4.1 空室検索のテスト
1. ブラウザで `http://localhost:3000/reservation` にアクセス
2. チェックイン・チェックアウト日を選択
3. 宿泊人数を入力
4. 「空室を検索」をクリック
5. 利用可能な部屋が表示されることを確認

### 4.2 予約作成のテスト
1. 部屋を選択
2. お客様情報を入力
3. 「予約を確定する」をクリック
4. スプレッドシートに予約データが追加されることを確認
5. Google Calendarに予約が登録されることを確認

## 🔒 ステップ5: セキュリティと最適化

### 5.1 スプレッドシートの保護
1. 「部屋管理」シートを保護
2. 編集権限を制限

### 5.2 データ検証の追加
1. 「予約」シートの各列にデータ検証を設定
2. 日付形式、電話番号形式などの検証

### 5.3 自動バックアップ
1. 定期的なバックアップを設定
2. 予約データのアーカイブ機能

## 📊 管理機能

### 1. 予約状況の確認
- スプレッドシートで予約一覧を確認
- Google Calendarで視覚的に確認

### 2. 統計機能
- 部屋別の稼働率
- 月別・週別の予約数
- 売上統計

### 3. 自動化
- 予約確認メールの自動送信
- チェックイン前日のリマインダー
- 定期的なレポート生成

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### 1. カレンダーが見つからない
**解決方法**: 
- カレンダーIDが正しいか確認
- カレンダーの共有設定を確認

#### 2. 予約が重複する
**解決方法**: 
- 空室検索のロジックを確認
- カレンダーの同期を確認

#### 3. 料金計算が間違っている
**解決方法**: 
- 部屋設定の料金を確認
- 宿泊日数の計算を確認

これで完全に動作する予約システムが完成します！
